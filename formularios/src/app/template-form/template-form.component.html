<!--
  criação de variável local #f
  que representa o formulário
  associada à diretiva ngForm
  do próprio Angular.
 -->
<form #f="ngForm" (ngSubmit)="onSubmit(f)" class="form-horizontal">
  <div class="form-group"
    [class.has-error]="nomeVar.invalid && nomeVar.touched"
    [class.has-feedback]="nomeVar.invalid && nomeVar.touched">

    <div class="col-sm-12">
      <label class="control-label" for="nome">Nome</label>
    </div>
    
    <div class="col-sm-12">
      <!-- 
        com ngModel precisamos usar o atributo
        'name' para o angular inferir o valor
        do campo na submissão do formulário
      -->
      <input type="text" class="form-control" id="nome" placeholder="Nome" required
      name="nome" [(ngModel)]="usuario.nome" 
      aria-describedby="nomeStatus"
      #nomeVar="ngModel"> <!-- 
                            para que as variáveis locais estejam visíveis em todo
                            o escopo do template, devemos atribuí-las ao ngModel

                            Ex.: #nomeVariavel="ngModel"
                          -->

      <span class="glyphicon glyphicon-remove form-control-feedback" aria-hidden="true"
        *ngIf="nomeVar.invalid && nomeVar.touched"></span>
      <span id="nomeStatus" class="sr-only">(error)</span>

      <p *ngIf="nomeVar.invalid && nomeVar.touched" 
        class="alert alert-danger" role="alert">
        O campo 'Nome' é obrigatório
      </p>
    </div>
  </div>

  <div class="form-group"
    [ngClass]="{
      'has-error': emailVar.invalid && emailVar.touched,
      'has-feedback': emailVar.invalid && emailVar.touched
    }">

    <div class="col-sm-12">
      <label class="control-label" for="email">Email</label>
    </div>
    
    <div class="col-sm-12">
      <input type="email" class="form-control" id="email" placeholder="seu-email@email.com" required
      name="email" [(ngModel)]="usuario.email" #emailVar="ngModel"
      aria-describedby="emailStatus" 
      email> <!-- 
              por último, o uso da diretiva 'email' para
              validar campos de email a partir do Angular 4
            -->

      <span class="glyphicon glyphicon-remove form-control-feedback" aria-hidden="true"
        *ngIf="emailVar.invalid && emailVar.touched"></span>
      <span id="emailStatus" class="sr-only">(error)</span>

      <p *ngIf="emailVar.invalid && emailVar.touched" 
        class="alert alert-danger" role="alert">
        O campo 'Email' é obrigatório
      </p>
    </div>
  </div>

  <div class="form-group">
    <div class="col-md-3"
      [ngClass]="{
        'has-error': cepVar.invalid && cepVar.touched,
        'has-feedback': cepVar.invalid && cepVar.touched
      }">
        <label for="cep" class="control-label">CEP</label>
        <input type="text" class="form-control" id="cep"
          name="cep" ngModel #cepVar="ngModel" required>

        <span class="glyphicon glyphicon-remove form-control-feedback" aria-hidden="true"
        *ngIf="cepVar.invalid && cepVar.touched"></span>
        <span id="cepStatus" class="sr-only">(error)</span>

        <p *ngIf="cepVar.invalid && cepVar.touched" 
          class="alert alert-danger" role="alert">
          O campo 'CEP' é obrigatório
        </p>
    </div>

    <div class="col-md-3"
      [ngClass]="{
        'has-error': numeroVar.invalid && numeroVar.touched,
        'has-feedback': numeroVar.invalid && numeroVar.touched
      }">
        <label for="numero" class="control-label">Número</label>
        <input type="text" class="form-control" id="numero"
          name="numero" ngModel #numeroVar="ngModel" required>


        <span class="glyphicon glyphicon-remove form-control-feedback" aria-hidden="true"
        *ngIf="numeroVar.invalid && numeroVar.touched"></span>
        <span id="numeroStatus" class="sr-only">(error)</span>

        <p *ngIf="numeroVar.invalid && numeroVar.touched" 
          class="alert alert-danger" role="alert">
          O campo 'Número' é obrigatório
        </p>
    </div>

    <div class="col-md-6">
      <label for="complemento" class="control-label">Complemento</label>
      <input type="text" class="form-control" id="complemento"
          name="complemento" ngModel #complementoVar="ngModel">
    </div>
  </div>

  <div class="form-group"
    [class.has-error]="ruaVar.invalid && ruaVar.touched"
    [class.has-feedback]="ruaVar.invalid && ruaVar.touched">

    <div class="col-sm-12">
      <label class="control-label" for="rua">Rua</label>
    </div>
    
    <div class="col-sm-12">
      <!-- 
        com o atributo readonly o usuário não pode editar o campo
      -->
      <input type="text" class="form-control" id="rua" required readonly
      name="rua" [(ngModel)]="usuario.rua" 
      aria-describedby="ruaStatus"
      #ruaVar="ngModel"> 

      <span class="glyphicon glyphicon-remove form-control-feedback" aria-hidden="true"
        *ngIf="ruaVar.invalid && ruaVar.touched"></span>
      <span id="ruaStatus" class="sr-only">(error)</span>

      <p *ngIf="ruaVar.invalid && ruaVar.touched" 
        class="alert alert-danger" role="alert">
        O campo 'Rua' é obrigatório
      </p>
    </div>
  </div>

  <div class="form-group">
      <div class="col-md-5"
        [ngClass]="{
        'has-error': bairroVar.invalid && bairroVar.touched,
        'has-feedback': bairroVar.invalid && bairroVar.touched
        }">
        <label for="bairro" class="control-label">Bairro</label>
        <input type="text" class="form-control" id="bairro"
            name="bairro" ngModel #bairroVar="ngModel" required readonly>
    
        <span class="glyphicon glyphicon-remove form-control-feedback" aria-hidden="true"
        *ngIf="bairroVar.invalid && bairroVar.touched"></span>
        <span id="bairroStatus" class="sr-only">(error)</span>
    
        <p *ngIf="bairroVar.invalid && bairroVar.touched" 
            class="alert alert-danger" role="alert">
            O campo 'Bairro' é obrigatório
        </p>
    </div>

    <div class="col-md-4"
      [ngClass]="{
      'has-error': cidadeVar.invalid && cidadeVar.touched,
      'has-feedback': cidadeVar.invalid && cidadeVar.touched
      }">
      <label for="cidade" class="control-label">Cidade</label>
      <input type="text" class="form-control" id="cidade"
          name="cidade" ngModel #cidadeVar="ngModel" required readonly>

      <span class="glyphicon glyphicon-remove form-control-feedback" aria-hidden="true"
      *ngIf="cidadeVar.invalid && cidadeVar.touched"></span>
      <span id="cidadeStatus" class="sr-only">(error)</span>

      <p *ngIf="cidadeVar.invalid && cidadeVar.touched" 
          class="alert alert-danger" role="alert">
          O campo 'Cidade' é obrigatório
      </p>
    </div>

    <div class="col-md-3"
      [ngClass]="{
      'has-error': estadoVar.invalid && estadoVar.touched,
      'has-feedback': estadoVar.invalid && estadoVar.touched
      }">
      <label for="estado" class="control-label">Estado</label>
      <input type="text" class="form-control" id="estado"
          name="estado" ngModel #estadoVar="ngModel" required>

      <span class="glyphicon glyphicon-remove form-control-feedback" aria-hidden="true"
      *ngIf="estadoVar.invalid && estadoVar.touched"></span>
      <span id="estadoStatus" class="sr-only">(error)</span>

      <p *ngIf="estadoVar.invalid && estadoVar.touched" 
          class="alert alert-danger" role="alert">
          O campo 'Estado' é obrigatório
      </p>
    </div>
  </div>

  <button type="submit" class="btn btn-primary"
    [disabled]="!f.valid">Enviar</button>

    <app-form-debug [form]="f"></app-form-debug>
</form>